Bootstrap: docker
From: ubuntu:20.04

%files
    . /project

%environment
    export PATH=$PATH:/usr/local/bin
    export OMPI_CC=gcc
    export OMPI_CXX=g++

%post
    apt-get update
    export DEBIAN_FRONTEND=noninteractive
    apt-get install -y tzdata
    apt-get update && apt-get install -y build-essential cmake mpich
    apt-get install -y gcc openmpi-bin libopenmpi-dev
    cd /project
    mkdir -p build && cd build
    cmake ..
    cmake --build .
    
%runscript
    mpirun -np 2 ./build/main