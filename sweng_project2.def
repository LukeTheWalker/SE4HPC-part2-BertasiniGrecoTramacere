Bootstrap: docker
From: ubuntu:20.04

%files
    . /project

%post
    apt-get update
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y build-essential cmake mpich
    apt-get install -y gcc openmpi-bin libopenmpi-dev
    cd /project
    mkdir -p build && cd build
    cmake ..
    cmake --build .
    cp /project/build/main /project
    
%runscript
    export OMPI_MCA_btl=^openib
    export HWLOC_COMPONENTS=-gl
    mpirun -n 2 /project/main